<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.co.hangsho.item.mappers.ItemMapper">

	<select id="getSeq" resultType="int">
		select
			item_seq.nextval 
		from
			dual
	</select>

	<insert id="addItem" parameterType="Item">
		insert into product_details
		(item_id, item_option, initial_quantity, saled_quantity, product_id, item_sale_price, item_original_price, image_id)
		values
		(#{id}, #{options}, #{initialQuantity}, #{saledQuantity}, #{"product.id"}, #{salePrice}, #{originalPrice}, #{"image.id"})
	</insert>
	
	<select id="getItems" parameterType="Criteria" resultType="Item">
		select
			I.item_id				as id,
			I.item_option			as options,
			I.initial_quantity	as initialQuantity,
			I.saled_quantity		as saledQuantity,
			P.product_name			as "product.name",
			I.item_original_price	as originalPrice,
			I.item_sale_price		as salePrice,
			I.image_id			as image,
			I.item_createdate		as createdate,
			C.company_name		as "product.company.name"
		from
			items I, products P, companies C
		where
			I.product_id = P.product_id
			and P.company_id = C.company_id
			<if test="keyword != ''">
				<choose>
					<when test="opt == 'title'">
						and P.product_name like '%' || #{keyword} || '%'
					</when>
					<when test="opt == 'seller'">
						and C.company_name like '%' || #{keyword} || '%'
					</when>
				</choose>
			</if>
	</select>
	
	<select id="getItemByProductNo" parameterType="int" resultType="Item">
		select
			item_id				as id,
			item_option			as options,
			initial_quantity	as initialQuantity,
			saled_quantity		as saledQuantity,
			product_id			as "product.id",
			item_original_price	as originalPrice,
			item_sale_price		as salePrice,
			image_id			as image,
			item_createdate		as createdate
		from
			items
		where
			item_id = #{value}
	</select>
	
	
</mapper>
