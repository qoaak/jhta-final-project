<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
 	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="kr.co.hangsho.charts.mappers.ChartMapper">

<select id="getDailyChart" parameterType="CriteriaForChart" resultType="ProfitChart">
	select 
		B.tm											as tm,
		nvl(sum(A.profit), 0)					as profit,
		nvl(sum(order_quantity), 0)		as qty
		from (
				select
				to_char(order_date, 'hh24') hours, order_quantity,
				(B.order_quantity * C.item_sale_price) - (B.order_quantity * C.item_original_price) as profit
				from orders A, order_details B, items C
				where A.order_id = B.order_id
				and B.item_id = C.item_id
				and to_char(A.order_date, 'yyyy-MM-dd') = #{selectDate}
				and B.item_id = #{itemId}
				) A ,
				(
					select lpad(level-1 , 2, '0') tm
				    from dual connect by level &lt;= 24
				) B
		where A.hours(+) = B.tm 
		group by B.tm
		order by B.tm
</select>

<select id="getMonthChart" parameterType="CriteriaForChart" resultType="ProfitChart">
	select 
		B.dd											as tm,
		nvl(sum(A.profit), 0)					as profit,
		nvl(sum(order_quantity), 0)		as qty
		from (
				select
				to_char(order_date, 'dd') days, order_quantity,
				(B.order_quantity * C.item_sale_price) - (B.order_quantity * C.item_original_price) as profit
				from orders A, order_details B, items C
				where A.order_id = B.order_id
				and B.item_id = C.item_id
				and to_char(A.order_date, 'yyyy-MM') = #{selectDate}
				and B.item_id = #{itemId}
				) A ,
				(
					select lpad(level , 2, '0') dd
				    from dual connect by level &lt;= 31
				) B
		where A.days(+) = B.dd 
		group by B.dd
		order by B.dd
</select>

</mapper>





















